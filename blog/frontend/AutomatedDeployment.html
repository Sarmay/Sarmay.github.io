<!DOCTYPE html>
<html lang="ç®€ä½“ä¸­æ–‡">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>è‡ªåŠ¨åŒ–éƒ¨ç½² | Sarmayçš„ä¸ªäººåšå®¢</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/images/logo.jpg">
    <meta name="description" content="ä½ è¿™é‡Œå¯ä»¥å­¦åˆ°å¾ˆå¤šæœ‰è¶£çš„çŸ¥è¯†">
    <link rel="preload" href="/assets/css/0.styles.c08026f3.css" as="style"><link rel="preload" href="/assets/js/app.eacb9a3b.js" as="script"><link rel="preload" href="/assets/js/3.cc61e45a.js" as="script"><link rel="preload" href="/assets/js/2.ab83f102.js" as="script"><link rel="preload" href="/assets/js/13.d16f0d80.js" as="script"><link rel="prefetch" href="/assets/js/10.8628b813.js"><link rel="prefetch" href="/assets/js/11.e088a4bc.js"><link rel="prefetch" href="/assets/js/12.0b0e3ada.js"><link rel="prefetch" href="/assets/js/14.d7a1cbac.js"><link rel="prefetch" href="/assets/js/15.ed5fbd0c.js"><link rel="prefetch" href="/assets/js/16.dd9a14d4.js"><link rel="prefetch" href="/assets/js/17.75201967.js"><link rel="prefetch" href="/assets/js/18.1cbdefb1.js"><link rel="prefetch" href="/assets/js/19.e78bb6fc.js"><link rel="prefetch" href="/assets/js/20.c20236b7.js"><link rel="prefetch" href="/assets/js/21.7d857103.js"><link rel="prefetch" href="/assets/js/22.6050c931.js"><link rel="prefetch" href="/assets/js/23.693c2848.js"><link rel="prefetch" href="/assets/js/24.c615da08.js"><link rel="prefetch" href="/assets/js/4.8fe38ee6.js"><link rel="prefetch" href="/assets/js/5.9d905708.js"><link rel="prefetch" href="/assets/js/6.3e468fa8.js"><link rel="prefetch" href="/assets/js/7.578389d4.js"><link rel="prefetch" href="/assets/js/8.556a1282.js"><link rel="prefetch" href="/assets/js/9.2a193b0f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c08026f3.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container reform"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="Sarmayçš„ä¸ªäººåšå®¢" class="logo"> <span class="site-name can-hide">Sarmayçš„ä¸ªäººåšå®¢</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><span class="reform-jia" style="font-size:1rem;"></span>
ä¸»é¡µ</a></div><div class="nav-item"><a href="/tags/" class="nav-link"><span class="reform-binggun" style="font-size:1rem;"></span>
æ ‡ç­¾äº‘</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="reform-jiqiren"></span> <span class="title">åšæ–‡</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/" class="nav-link router-link-active"><span class="reform-qiehuan" style="font-size:1rem;"></span>
å‰ç«¯</a></li><li class="dropdown-item"><!----> <a href="/blog/backend/" class="nav-link"><span class="reform-shubiao" style="font-size:1rem;"></span>
åç«¯</a></li><li class="dropdown-item"><!----> <a href="/blog/server/" class="nav-link"><span class="reform-yuanxing" style="font-size:1rem;"></span>
æœåŠ¡å™¨</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link"><span class="reform-haoyou" style="font-size:1rem;"></span>
å…³äºæˆ‘</a></div><div class="nav-item"><a href="http://www.sarmay.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å®˜ç½‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><!----> <span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/AutomatedDeployment.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!---->
ç®€ä½“ä¸­æ–‡</a></li><li class="dropdown-item"><!----> <a href="/kz/blog/frontend/AutomatedDeployment.html" class="nav-link"><!---->
ÒšĞ°Ğ·Ğ°Ò›ÑˆĞ°</a></li></ul></div></div> <a href="https://github.com/sarmay" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><span class="reform-jia" style="font-size:1rem;"></span>
ä¸»é¡µ</a></div><div class="nav-item"><a href="/tags/" class="nav-link"><span class="reform-binggun" style="font-size:1rem;"></span>
æ ‡ç­¾äº‘</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="reform-jiqiren"></span> <span class="title">åšæ–‡</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/" class="nav-link router-link-active"><span class="reform-qiehuan" style="font-size:1rem;"></span>
å‰ç«¯</a></li><li class="dropdown-item"><!----> <a href="/blog/backend/" class="nav-link"><span class="reform-shubiao" style="font-size:1rem;"></span>
åç«¯</a></li><li class="dropdown-item"><!----> <a href="/blog/server/" class="nav-link"><span class="reform-yuanxing" style="font-size:1rem;"></span>
æœåŠ¡å™¨</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link"><span class="reform-haoyou" style="font-size:1rem;"></span>
å…³äºæˆ‘</a></div><div class="nav-item"><a href="http://www.sarmay.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  å®˜ç½‘
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><!----> <span class="title">é€‰æ‹©è¯­è¨€</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/frontend/AutomatedDeployment.html" aria-current="page" class="nav-link router-link-exact-active router-link-active"><!---->
ç®€ä½“ä¸­æ–‡</a></li><li class="dropdown-item"><!----> <a href="/kz/blog/frontend/AutomatedDeployment.html" class="nav-link"><!---->
ÒšĞ°Ğ·Ğ°Ò›ÑˆĞ°</a></li></ul></div></div> <a href="https://github.com/sarmay" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>è‡ªåŠ¨åŒ–éƒ¨ç½²</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/frontend/AutomatedDeployment.html#ç¬¬ä¸€æ­¥-æ‰“å¼€-ssh-ç»ˆç«¯-â€‹" class="sidebar-link">ç¬¬ä¸€æ­¥ æ‰“å¼€ SSH ç»ˆç«¯ ğŸš‘â€‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/frontend/AutomatedDeployment.html#ç¬¬äºŒæ­¥-æ‰“å¼€-webhook-å·¥å…·-â€‹" class="sidebar-link">ç¬¬äºŒæ­¥ æ‰“å¼€ WebHook å·¥å…· ğŸ“â€‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/frontend/AutomatedDeployment.html#ç¬¬ä¸‰æ­¥-æ‰“å¼€-gitee-ç äº‘-â€‹" class="sidebar-link">ç¬¬ä¸‰æ­¥ æ‰“å¼€ gitee ç äº‘ âœ¨â€‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/frontend/AutomatedDeployment.html#ç¬¬å››æ­¥-æ‰“å¼€-pm2-â€‹" class="sidebar-link">ç¬¬å››æ­¥ æ‰“å¼€ PM2 ğŸš€â€‹</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/frontend/AutomatedDeployment.html#ç¬¬äº”æ­¥-â€‹" class="sidebar-link">ç¬¬äº”æ­¥ âœ…â€‹</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/frontend/AutomatedDeployment.html#é‡å¯æœåŠ¡å™¨-â€‹" class="sidebar-link">é‡å¯æœåŠ¡å™¨ ğŸâ€‹</a></li></ul></li><li><a href="/blog/frontend/AutomatedDeployment.html#ç¬¬å…­æ­¥-â€‹" class="sidebar-link">ç¬¬å…­æ­¥ ğŸ‰â€‹</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page" data-v-4295b1aa> <section class="tags" data-v-4295b1aa><span class="tagPopup" data-v-4295b1aa><a href="/tags/?tag=%E9%83%A8%E7%BD%B2" class="tag" data-v-4295b1aa>éƒ¨ç½²</a></span><span class="tagPopup" data-v-4295b1aa><a href="/tags/?tag=%E8%87%AA%E5%8A%A8%E5%8C%96" class="tag" data-v-4295b1aa>è‡ªåŠ¨åŒ–</a></span><span class="tagPopup" data-v-4295b1aa><a href="/tags/?tag=node" class="tag" data-v-4295b1aa>node</a></span></section> <div class="content theme-default-content content__default" data-v-4295b1aa><h1 id="è‡ªåŠ¨åŒ–éƒ¨ç½²é¡¹ç›®"><a href="#è‡ªåŠ¨åŒ–éƒ¨ç½²é¡¹ç›®" class="header-anchor">#</a> è‡ªåŠ¨åŒ–éƒ¨ç½²é¡¹ç›® ğŸ‘‹</h1> <h3 id="å¿…å¤‡è½¯ä»¶-â€‹â€‹"><a href="#å¿…å¤‡è½¯ä»¶-â€‹â€‹" class="header-anchor">#</a> å¿…å¤‡è½¯ä»¶ â€‹ğŸ—â€‹</h3> <ol><li>SSH ç»ˆç«¯ <code>V1.0+</code></li> <li>WebHook å·¥å…· <code>V1.2+</code></li> <li>PM2 ç®¡ç†å™¨ <code>V4.2.3+</code></li></ol> <h2 id="ç¬¬ä¸€æ­¥-æ‰“å¼€-ssh-ç»ˆç«¯-â€‹"><a href="#ç¬¬ä¸€æ­¥-æ‰“å¼€-ssh-ç»ˆç«¯-â€‹" class="header-anchor">#</a> ç¬¬ä¸€æ­¥ æ‰“å¼€ SSH ç»ˆç«¯ ğŸš‘â€‹</h2> <ol><li><p>cd åˆ°è‡ªå·±è¦ä¸‹è½½ä¿å­˜é¡¹ç›®çš„ç›®å½•ï¼Œå¹¶ Clone é¡¹ç›®</p></li> <li><p>ç„¶å cd è¿›æ‹·è´ä¸‹æ¥çš„é¡¹ç›®</p></li> <li><p>ç„¶åè¾“å…¥ <code>git config --global credential.helper store</code></p></li> <li><p>æ‰§è¡Œ <code>git pull</code>æ‹‰å»ä»£ç </p></li></ol> <h2 id="ç¬¬äºŒæ­¥-æ‰“å¼€-webhook-å·¥å…·-â€‹"><a href="#ç¬¬äºŒæ­¥-æ‰“å¼€-webhook-å·¥å…·-â€‹" class="header-anchor">#</a> ç¬¬äºŒæ­¥ æ‰“å¼€ WebHook å·¥å…· ğŸ“â€‹</h2> <ol><li><p>æ·»åŠ ï¼Œåç§°è¦å’Œè‡ªå·±é¡¹ç›®çš„è‹±æ–‡åœ°å€ä¸€è‡´</p></li> <li><p>æ‰§è¡Œè„šæœ¬ç²˜è´´ä¸‹æ–¹ä»£ç ï¼Œå¹¶ä¿®æ”¹è‡ªå·±çš„ <code>git åç§°</code>å’Œ<code>é¡¹ç›®ä¸‹è½½çš„ç›®å½•</code></p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/bin/bash</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;&quot;</span>
<span class="token function">date</span> --date<span class="token operator">=</span><span class="token string">'0 days ago'</span> <span class="token string">&quot;+%Y-%m-%d %H:%M:%S&quot;</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;Start&quot;</span>
<span class="token comment">#åˆ¤æ–­WebHookå‚æ•°æ˜¯å¦å­˜åœ¨</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -n <span class="token string">&quot;<span class="token variable">$1</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">then</span>
          <span class="token builtin class-name">echo</span> <span class="token string">&quot;paramå‚æ•°é”™è¯¯&quot;</span>
          <span class="token builtin class-name">echo</span> <span class="token string">&quot;End&quot;</span>
          <span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
<span class="token comment">#è·¯å¾„è‡ªå·±å®šä¹‰</span>
<span class="token assign-left variable">gitPath</span><span class="token operator">=</span><span class="token string">&quot;/www/wwwroot/é¡¹ç›®è·¯å¾„/<span class="token variable">$1</span>&quot;</span>
<span class="token assign-left variable">gitHttp</span><span class="token operator">=</span><span class="token string">&quot;https://gitee.com/è‡ªå·±çš„gitåç§°/<span class="token variable">$1</span>.git&quot;</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;Webç«™ç‚¹è·¯å¾„ï¼š<span class="token variable">$gitPath</span>&quot;</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> -d <span class="token string">&quot;<span class="token variable">$gitPath</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
        <span class="token builtin class-name">cd</span> <span class="token variable">$gitPath</span>
        <span class="token comment">#åˆ¤æ–­æ˜¯å¦å­˜åœ¨gitç›®å½•</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;.git&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;åœ¨è¯¥ç›®å½•ä¸‹å…‹éš†&quot;</span>
                <span class="token function">sudo</span> <span class="token function">git</span> clone <span class="token variable">$gitHttp</span> gittemp
                <span class="token function">sudo</span> <span class="token function">mv</span> gittemp/.git <span class="token builtin class-name">.</span>
                <span class="token function">sudo</span> <span class="token function">rm</span> -rf gittemp
        <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;æ‹‰å–æœ€æ–°çš„é¡¹ç›®æ–‡ä»¶&quot;</span>
        <span class="token function">sudo</span> <span class="token function">git</span> reset --hard origin/master
        <span class="token function">sudo</span> <span class="token function">git</span> pull
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;è®¾ç½®ç›®å½•æƒé™&quot;</span>
        <span class="token function">sudo</span> <span class="token function">chown</span> -R www:www <span class="token variable">$gitPath</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;End&quot;</span>
        <span class="token builtin class-name">exit</span>
<span class="token keyword">else</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;è¯¥é¡¹ç›®è·¯å¾„ä¸å­˜åœ¨&quot;</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;æ–°å»ºé¡¹ç›®ç›®å½•&quot;</span>
        <span class="token function">mkdir</span> <span class="token variable">$gitPath</span>
        <span class="token builtin class-name">cd</span> <span class="token variable">$gitPath</span>
        <span class="token comment">#åˆ¤æ–­æ˜¯å¦å­˜åœ¨gitç›®å½•</span>
        <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token operator">!</span> -d <span class="token string">&quot;.git&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;åœ¨è¯¥ç›®å½•ä¸‹å…‹éš† git&quot;</span>
                <span class="token function">sudo</span> <span class="token function">git</span> clone <span class="token variable">$gitHttp</span> gittemp
                <span class="token function">sudo</span> <span class="token function">mv</span> gittemp/.git <span class="token builtin class-name">.</span>
                <span class="token function">sudo</span> <span class="token function">rm</span> -rf gittemp
        <span class="token keyword">fi</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;æ‹‰å–æœ€æ–°çš„é¡¹ç›®æ–‡ä»¶&quot;</span>
        <span class="token function">sudo</span> <span class="token function">git</span> reset --hard origin/master
        <span class="token function">sudo</span> <span class="token function">git</span> pull
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;è®¾ç½®ç›®å½•æƒé™&quot;</span>
        <span class="token function">sudo</span> <span class="token function">chown</span> -R www:www <span class="token variable">$gitPath</span>
        <span class="token builtin class-name">echo</span> <span class="token string">&quot;End&quot;</span>
        <span class="token builtin class-name">exit</span>
<span class="token keyword">fi</span>
</code></pre></div></li> <li><p>ç‚¹å‡»æŸ¥çœ‹ç§˜é’¥</p></li> <li><p>å¤åˆ¶ <code>GET/POST</code> ä¸‹é¢çš„ <code>https</code> å¼€å§‹è‡³ <code>param=aaa</code> ç»“æŸçš„éƒ¨åˆ†ï¼Œå¹¶ä¸” <code>param=</code>åé¢çš„ <code>aaa</code>æ”¹æˆè‡ªå·±çš„<code>é¡¹ç›®è‹±æ–‡åç§°</code></p></li></ol> <h2 id="ç¬¬ä¸‰æ­¥-æ‰“å¼€-gitee-ç äº‘-â€‹"><a href="#ç¬¬ä¸‰æ­¥-æ‰“å¼€-gitee-ç äº‘-â€‹" class="header-anchor">#</a> ç¬¬ä¸‰æ­¥ æ‰“å¼€ gitee ç äº‘ âœ¨â€‹</h2> <ol><li>è¿›å…¥è‡ªå·±çš„é¡¹ç›®ç‚¹å‡»ç®¡ç†ï¼Œç‚¹å‡» <code>webhook</code>ï¼Œåœ°å€é‡Œç²˜è´´åˆšæ‰çš„åœ°å€ä¿å­˜</li></ol> <h2 id="ç¬¬å››æ­¥-æ‰“å¼€-pm2-â€‹"><a href="#ç¬¬å››æ­¥-æ‰“å¼€-pm2-â€‹" class="header-anchor">#</a> ç¬¬å››æ­¥ æ‰“å¼€ PM2 ğŸš€â€‹</h2> <ol><li><p><code>PM2</code> ç‚¹å‡»æ—è¾¹çš„æ–‡ä»¶å¤¹å›¾æ ‡ è¿›å…¥<code>pm2</code> çš„æ ¹æ–‡ä»¶è·¯å¾„åº”è¯¥æ˜¯<code>/www/server/panel/plugin/pm2</code></p></li> <li><p>ä¿®æ”¹ <code>pm2_main.py</code> æ–‡ä»¶ åˆ é™¤ <code>pm2_main.pyc</code> æ–‡ä»¶</p></li></ol> <div class="language-py extra-class"><pre class="language-py"><code>   <span class="token comment">#!/usr/bin/python</span>
   <span class="token comment">#coding: utf-8</span>
   <span class="token comment">#-----------------------------</span>
   <span class="token comment"># PM2ç®¡ç†æ’ä»¶</span>
   <span class="token comment">#-----------------------------</span>
   <span class="token keyword">import</span> sys<span class="token punctuation">,</span>os<span class="token punctuation">,</span>psutil
   os<span class="token punctuation">.</span>chdir<span class="token punctuation">(</span><span class="token string">'/www/server/panel'</span><span class="token punctuation">)</span>
   sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">&quot;class/&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">import</span> public<span class="token punctuation">,</span>re<span class="token punctuation">,</span>json

   <span class="token keyword">class</span> <span class="token class-name">pm2_main</span><span class="token punctuation">:</span>
       __SR <span class="token operator">=</span> <span class="token boolean">None</span>
       __path <span class="token operator">=</span> <span class="token string">'/www/server/panel/plugin/pm2/list/'</span>

       <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
           s_path <span class="token operator">=</span> <span class="token string">'/www'</span>
           <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>islink<span class="token punctuation">(</span>s_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
               s_path<span class="token operator">=</span>os<span class="token punctuation">.</span>readlink<span class="token punctuation">(</span>s_path<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/server'</span>
           <span class="token keyword">else</span><span class="token punctuation">:</span>
               s_path <span class="token operator">+=</span> <span class="token string">'/server'</span>
               <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>islink<span class="token punctuation">(</span>s_path<span class="token punctuation">)</span><span class="token punctuation">:</span>
                   s_path <span class="token operator">=</span> os<span class="token punctuation">.</span>readlink<span class="token punctuation">(</span>s_path<span class="token punctuation">)</span>
           self<span class="token punctuation">.</span>__SR <span class="token operator">=</span> <span class="token triple-quoted-string string">'''#!/bin/bash
   PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/local/bin:/usr/local/sbin:~/bin
   export PATH
   export HOME=/root
   export NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node
   export NVM_DIR=&quot;{}/nvm&quot;
   source /www/server/nvm/nvm.sh ; '''</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>s_path<span class="token punctuation">)</span>

       <span class="token comment">#åˆ—è¡¨</span>
       <span class="token keyword">def</span> <span class="token function">List</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           <span class="token keyword">try</span><span class="token punctuation">:</span>
               tmp <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">&quot;pm2 list -m|grep -v 'pm2 list'|grep -v 'In memory PM2'|grep -v 'Local PM2'&quot;</span><span class="token punctuation">)</span>
               appList <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'+---'</span><span class="token punctuation">)</span>
               result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
               tmp <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span><span class="token string">'lsof -c node -P|grep LISTEN'</span><span class="token punctuation">)</span>
               plist <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span>
               <span class="token keyword">for</span> app <span class="token keyword">in</span> appList<span class="token punctuation">:</span>
                   <span class="token keyword">try</span><span class="token punctuation">:</span>
                       <span class="token keyword">if</span> <span class="token keyword">not</span> app<span class="token punctuation">:</span> <span class="token keyword">continue</span>
                       tmp2 <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">r&quot;([\w ]+):(.+)&quot;</span><span class="token punctuation">,</span>app<span class="token punctuation">)</span>
                       tmp3 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                       <span class="token keyword">for</span> t <span class="token keyword">in</span> tmp2<span class="token punctuation">:</span>
                           tmp3<span class="token punctuation">[</span>t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> t<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                       tmp2 <span class="token operator">=</span> tmp3
                       appInfo <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'pm2 id'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'mode'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'mode'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>tmp2<span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'status'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'restart'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'restarted'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'uptime'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'uptime'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'cpu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
                       <span class="token keyword">if</span> appInfo<span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span> <span class="token keyword">and</span> appInfo<span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'N/A'</span><span class="token punctuation">:</span>
                           <span class="token keyword">try</span><span class="token punctuation">:</span>
                               appInfo<span class="token punctuation">[</span><span class="token string">'cpu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> psutil<span class="token punctuation">.</span>Process<span class="token punctuation">(</span>appInfo<span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cpu_percent<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>
                           <span class="token keyword">except</span><span class="token punctuation">:</span>  appInfo<span class="token punctuation">[</span><span class="token string">'cpu'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>

                       appInfo<span class="token punctuation">[</span><span class="token string">'mem'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'memory usage'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'root'</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'watching'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp2<span class="token punctuation">[</span><span class="token string">'watching'</span><span class="token punctuation">]</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'OFF'</span>
                       appInfo<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'OFF'</span>
                       <span class="token keyword">for</span> p <span class="token keyword">in</span> plist<span class="token punctuation">:</span>
                           ptmp <span class="token operator">=</span> p<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token punctuation">)</span>
                           <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>ptmp<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">8</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>
                           <span class="token keyword">if</span> ptmp<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token builtin">str</span><span class="token punctuation">(</span>appInfo<span class="token punctuation">[</span><span class="token string">'pid'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> appInfo<span class="token punctuation">[</span><span class="token string">'port'</span><span class="token punctuation">]</span> <span class="token operator">=</span> ptmp<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">':'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>

                       <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path <span class="token operator">+</span> appInfo<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span> appInfo<span class="token punctuation">[</span><span class="token string">'path'</span><span class="token punctuation">]</span> <span class="token operator">=</span> public<span class="token punctuation">.</span>readFile<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path <span class="token operator">+</span> appInfo<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                       result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>appInfo<span class="token punctuation">)</span>
                   <span class="token keyword">except</span><span class="token punctuation">:</span> <span class="token keyword">continue</span>
               <span class="token keyword">return</span> result
           <span class="token keyword">except</span><span class="token punctuation">:</span>
               <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'è¯·æ£€æŸ¥pm2æ˜¯å¦æ­£å¸¸!'</span><span class="token operator">+</span>public<span class="token punctuation">.</span>get_error_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

       <span class="token comment">#è·å–å·²å®‰è£…åº“</span>
       <span class="token keyword">def</span> <span class="token function">GetMod</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           tmp <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">&quot;npm list --depth=0 -global --json|grep -v '/www/server/nvm'&quot;</span><span class="token punctuation">)</span>
           modList <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
           result <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
           <span class="token keyword">for</span> m <span class="token keyword">in</span> modList<span class="token punctuation">[</span><span class="token string">'dependencies'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
               mod <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
               mod<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> <span class="token operator">=</span> m
               mod<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> modList<span class="token punctuation">[</span><span class="token string">'dependencies'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span>
               result<span class="token punctuation">.</span>append<span class="token punctuation">(</span>mod<span class="token punctuation">)</span>
           <span class="token keyword">return</span> result

       <span class="token comment">#å®‰è£…åº“</span>
       <span class="token keyword">def</span> <span class="token function">InstallMod</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'npm install '</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>mname <span class="token operator">+</span> <span class="token string">' -g'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'å®‰è£…æˆåŠŸ!'</span><span class="token punctuation">)</span>

       <span class="token comment">#å¸è½½åº“</span>
       <span class="token keyword">def</span> <span class="token function">UninstallMod</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           MyNot<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'pm2'</span><span class="token punctuation">,</span><span class="token string">'npm'</span><span class="token punctuation">]</span>
           <span class="token keyword">if</span> get<span class="token punctuation">.</span>mname <span class="token keyword">in</span> MyNot<span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'ä¸èƒ½å¸è½½['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>mname<span class="token operator">+</span><span class="token string">']'</span><span class="token punctuation">)</span>
           os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'npm uninstall '</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>mname <span class="token operator">+</span> <span class="token string">' -g'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'å¸è½½æˆåŠŸ!'</span><span class="token punctuation">)</span>

       <span class="token comment">#è·å–Nodeç‰ˆæœ¬åˆ—è¡¨</span>
       <span class="token keyword">def</span> <span class="token function">Versions</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           result <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
           rep <span class="token operator">=</span> <span class="token string">r'v\d+\.\d+\.\d+'</span>
           tmp <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR<span class="token operator">+</span><span class="token string">'nvm ls-remote --lts|grep -v v0|grep -v iojs'</span><span class="token punctuation">)</span>
           result<span class="token punctuation">[</span><span class="token string">'list'</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>rep<span class="token punctuation">,</span>tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
           tmp <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">&quot;nvm version&quot;</span><span class="token punctuation">)</span>
           result<span class="token punctuation">[</span><span class="token string">'version'</span><span class="token punctuation">]</span> <span class="token operator">=</span> tmp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span>
           <span class="token keyword">print</span><span class="token punctuation">(</span>tmp<span class="token punctuation">)</span>
           <span class="token keyword">return</span> result

       <span class="token comment">#åˆ‡æ¢Nodeç‰ˆæœ¬</span>
       <span class="token keyword">def</span> <span class="token function">SetNodeVersion</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           version <span class="token operator">=</span> get<span class="token punctuation">.</span>version<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'v'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
           estr <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
   export NVM_NODEJS_ORG_MIRROR=http://npm.taobao.org/mirrors/node &amp;&amp; nvm install %s
   nvm use --delete-prefix %s
   nvm alias default %s
   oldreg=`npm get registry`
   npm config set registry http://registry.npm.taobao.org/
   npm install pm2 -g
   npm config set registry $oldreg
   '''</span> <span class="token operator">%</span> <span class="token punctuation">(</span>version<span class="token punctuation">,</span>version<span class="token punctuation">,</span>version<span class="token punctuation">)</span>
           os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> estr<span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'å·²åˆ‡æ¢è‡³['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>version<span class="token operator">+</span><span class="token string">']'</span><span class="token punctuation">)</span>

       <span class="token comment">#æ·»åŠ </span>
       <span class="token keyword">def</span> <span class="token function">Add</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           <span class="token comment">#get.pname = get.pname.encode('utf-8');</span>
           <span class="token keyword">if</span> <span class="token keyword">not</span> re<span class="token punctuation">.</span>match<span class="token punctuation">(</span><span class="token string">r&quot;^\w+$&quot;</span><span class="token punctuation">,</span>get<span class="token punctuation">.</span>pname<span class="token punctuation">)</span><span class="token punctuation">:</span>
               <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®åç§°ä¸èƒ½åŒ…å«ç‰¹æ®Šç¬¦å·!'</span><span class="token punctuation">)</span>
           runFile <span class="token operator">=</span> <span class="token punctuation">(</span>get<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>run<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'//'</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">)</span>
           <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>runFile<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'æŒ‡å®šæ–‡ä»¶ä¸å­˜åœ¨!'</span><span class="token punctuation">)</span>
           Nlist <span class="token operator">=</span> self<span class="token punctuation">.</span>List<span class="token punctuation">(</span>get<span class="token punctuation">)</span>
           <span class="token keyword">for</span> node <span class="token keyword">in</span> Nlist<span class="token punctuation">:</span>
               <span class="token keyword">if</span> get<span class="token punctuation">.</span>pname <span class="token operator">==</span> node<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'æŒ‡å®šé¡¹ç›®åç§°å·²ç»å­˜åœ¨!'</span><span class="token punctuation">)</span>
           <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>get<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/package.json'</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>get<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">'/package-lock.json'</span><span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">&quot;cd &quot;</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>path <span class="token operator">+</span> <span class="token string">' &amp;&amp; npm install -s'</span><span class="token punctuation">)</span>
           os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'cd '</span><span class="token operator">+</span>get<span class="token punctuation">.</span>path<span class="token operator">+</span><span class="token string">' &amp;&amp; pm2 start '</span> <span class="token operator">+</span> runFile <span class="token operator">+</span>  <span class="token string">' --name &quot;'</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">'&quot; --watch|grep '</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token punctuation">)</span>
           public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 save &amp;&amp; pm2 startup'</span><span class="token punctuation">)</span>
           <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path<span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">'mkdir -p '</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>__path<span class="token punctuation">)</span>
           public<span class="token punctuation">.</span>writeFile<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token punctuation">,</span>get<span class="token punctuation">.</span>path<span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'ADD_SUCCESS'</span><span class="token punctuation">)</span>

       <span class="token comment">#å¯åŠ¨</span>
       <span class="token keyword">def</span> <span class="token function">Start</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           <span class="token comment">#get.pname = get.pname.encode('utf-8');</span>
           result <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 start &quot;'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname <span class="token operator">+</span> <span class="token string">'&quot; --watch|grep '</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
           <span class="token keyword">if</span> result<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'online'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']å·²å¯åŠ¨!'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']å¯åŠ¨å¤±è´¥!'</span><span class="token punctuation">)</span>

       <span class="token comment">#åœæ­¢</span>
       <span class="token keyword">def</span> <span class="token function">Stop</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           <span class="token comment">#get.pname = get.pname.encode('utf-8');</span>
           result <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 stop &quot;'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname <span class="token operator">+</span> <span class="token string">'&quot;|grep '</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
           <span class="token keyword">if</span> result<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'stoped'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']å·²åœæ­¢!'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']åœæ­¢å¤±è´¥!'</span><span class="token punctuation">)</span>

       <span class="token comment">#é‡å¯</span>
       <span class="token keyword">def</span> <span class="token function">Restart</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           <span class="token comment">#get.pname = get.pname.encode('utf-8');</span>
           result <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 restart &quot;'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname <span class="token operator">+</span> <span class="token string">'&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
           <span class="token keyword">if</span> result<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'âœ“'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']å·²é‡å¯!'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']é‡å¯å¤±è´¥!'</span><span class="token punctuation">)</span>

       <span class="token comment">#é‡è½½</span>
       <span class="token keyword">def</span> <span class="token function">Reload</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           <span class="token comment">#get.pname = get.pname.encode('utf-8');</span>
           result <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 reload &quot;'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname <span class="token operator">+</span> <span class="token string">'&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
           <span class="token keyword">if</span> result<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'âœ“'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']å·²é‡è½½!'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'é¡¹ç›®['</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">']é‡è½½å¤±è´¥!'</span><span class="token punctuation">)</span>

       <span class="token comment">#åˆ é™¤</span>
       <span class="token keyword">def</span> <span class="token function">Delete</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
          <span class="token comment"># get.pname = get.pname.encode('utf-8');</span>
           result <span class="token operator">=</span> public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 stop &quot;'</span><span class="token operator">+</span>get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">'&quot; &amp;&amp; pm2 delete &quot;'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname <span class="token operator">+</span> <span class="token string">'&quot;|grep &quot;'</span> <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token operator">+</span><span class="token string">'&quot;'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
           <span class="token keyword">if</span> result<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'âœ“'</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
               public<span class="token punctuation">.</span>ExecShell<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__SR <span class="token operator">+</span> <span class="token string">'pm2 save &amp;&amp; pm2 startup'</span><span class="token punctuation">)</span>
               <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token punctuation">)</span><span class="token punctuation">:</span> os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>self<span class="token punctuation">.</span>__path <span class="token operator">+</span> get<span class="token punctuation">.</span>pname<span class="token punctuation">)</span>
               <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token string">'DEL_SUCCESS'</span><span class="token punctuation">)</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>returnMsg<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">,</span><span class="token string">'DEL_ERROR'</span><span class="token punctuation">)</span>

       <span class="token comment">#è·å–æ—¥å¿—</span>
       <span class="token keyword">def</span> <span class="token function">GetLogs</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>get<span class="token punctuation">)</span><span class="token punctuation">:</span>
           path <span class="token operator">=</span> <span class="token string">'/root/.pm2/pm2.log'</span>
           <span class="token keyword">if</span> <span class="token keyword">not</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">return</span> <span class="token string">'å½“å‰æ²¡æœ‰æ—¥å¿—'</span>
           <span class="token keyword">return</span> public<span class="token punctuation">.</span>readFile<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

   <span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">&quot;__main__&quot;</span><span class="token punctuation">:</span>
       p <span class="token operator">=</span> pm2_main<span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token keyword">print</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>List<span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="ç¬¬äº”æ­¥-â€‹"><a href="#ç¬¬äº”æ­¥-â€‹" class="header-anchor">#</a> ç¬¬äº”æ­¥ âœ…â€‹</h2> <h3 id="é‡å¯æœåŠ¡å™¨-â€‹"><a href="#é‡å¯æœåŠ¡å™¨-â€‹" class="header-anchor">#</a> é‡å¯æœåŠ¡å™¨ ğŸâ€‹</h3> <h2 id="ç¬¬å…­æ­¥-â€‹"><a href="#ç¬¬å…­æ­¥-â€‹" class="header-anchor">#</a> ç¬¬å…­æ­¥ ğŸ‰â€‹</h2> <ol><li>æ‰“å¼€ <code>pm2</code> æ·»åŠ è‡ªå·±çš„é¡¹ç›®é…ç½®ä¸€ä¸‹æ˜ å°„ä¹‹ç±»çš„å°±å®Œæˆäº†</li></ol></div> <footer class="page-edit" data-v-4295b1aa><!----> <div class="last-updated" data-v-4295b1aa><span class="prefix" data-v-4295b1aa>æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time" data-v-4295b1aa>2020-10-13 18:12:10 æ˜ŸæœŸäºŒ</span></div></footer> <!----> <div id="gitalk-container" data-v-4295b1aa></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.eacb9a3b.js" defer></script><script src="/assets/js/3.cc61e45a.js" defer></script><script src="/assets/js/2.ab83f102.js" defer></script><script src="/assets/js/13.d16f0d80.js" defer></script>
  </body>
</html>
